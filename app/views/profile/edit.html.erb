<%= render "partial/back_button" %>

<!-- Main Container -->
<div class="container px-2 py-4">
  <div class="bg-white shadow-sm rounded-4 p-3">
    <h5 class="text-center text-primary mb-4">Edit Your Profile</h5>

    <%= form_with model: User.new, url: update_profile_path(@user), local: true do |f| %>

      <!-- Username -->
      <div class="mb-3">
        <%= f.label :user_name, "New Username", class: "form-label small fw-semibold" %>
        <%= f.text_field :user_name, class: "form-control form-control-sm", placeholder: "ex: AuBrian" %>
      </div>

      <!-- Avatar Upload -->
      <div class="mb-3">
        <%= f.label :avatar, "Profile Image", class: "form-label small fw-semibold" %>
        <%= f.file_field :avatar, accept: "image/*", class: "form-control form-control-sm" %>
      </div>

      <!-- Phone Number -->
      <div class="mb-3">
        <label for="phone_number" class="form-label small fw-semibold d-block mb-1">Phone Number</label>
        <input type="tel" id="phone_number" name="user[phone_number]" class="form-control form-control-sm" placeholder="Phone number">
      </div>

      <!-- Submit Button -->
      <div class="d-grid">
        <%= f.submit "Save", class: "btn btn-primary btn-sm" %>
      </div>

    <% end %>
  </div>
</div>
<!-- intl-tel-input CSS (optional for better styling) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@17/build/css/intlTelInput.min.css">

<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@17/build/js/intlTelInput.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@17/build/js/utils.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const input = document.querySelector("#phone_number");
    if (!input) return;

    const iti = window.intlTelInput(input, {
      utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@17/build/js/utils.js",
      initialCountry: "auto",
      geoIpLookup: callback => {
        fetch('https://ipapi.co/json')
          .then(res => res.json())
          .then(data => callback(data.country_code))
          .catch(() => callback("us"));
      },
      separateDialCode: true,
      preferredCountries: ["mu", "fr", "us"],
    });

    input.form.addEventListener("submit", function () {
      const fullNumber = iti.getNumber();
      input.value = fullNumber;
    });
  });
</script>
